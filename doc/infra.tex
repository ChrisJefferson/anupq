%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%W  infra.tex       ANUPQ documentation - infrastructure    Werner Nickel
%W                                                            Greg Gamble
%%
%H  $Id$
%%
%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Chapter{Infrastructure}

Most of the details in this chapter are of a technical nature;  the  user
need only skim over this chapter on a first reading. Mostly, it is enough
to know that

\beginlist

\item{$\bullet$} 
you must do a `RequirePackage("anupq");' before you can expect to  use  a
command  defined  by  the  {\ANUPQ}  Share  Package   (details   are   in
Section~"Loading the ANUPQ Share Package");

\item{$\bullet$}
partial results of {\ANUPQ} commands and some other data  are  stored  in
the `ANUPQData' global variable (details are  in  Section~"The  ANUPQData
Record"); 

\item{$\bullet$} 
doing `SetInfoLevel(InfoANUPQ, <n>);' for <n> greater  than  the  default
value 1 will give progressively more information  of  what  is  going  on
``behind the scenes'' (details are in Section~"Setting the  Verbosity  of
ANUPQ via Info and InfoANUPQ"); and

\item{$\bullet$} 
if you passed options to a function and ran into an error then you should
almost certainly type `ResetOptionsStack();' so  those  options  are  not
still on the `OptionsStack' to affect subsequent functions  (details  are
in Section~"Hints and Warnings regarding the use of Options").

\endlist

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Loading the ANUPQ Share Package}

To use the {\ANUPQ} Share Package you have to request it explicitly. This
is done by calling

\beginexample
gap> RequirePackage("anupq");
#I    Loading the ANUPQ (ANU p-Quotient) share package
#I    C code by  Eamonn O'Brien <obrien@math.auckland.ac.nz>
#I                ANU pq binary version: 1.5
#I    GAP code by Werner Nickel <nickel@mathematik.tu-darmstadt.de>
#I            and   Greg Gamble  <gregg@math.rwth-aachen.de>
#I                ANUPQ package version: 1.1
#I  
#I                For help, type: ?ANUPQ
true
\endexample

The `RequirePackage' command is described in Section~"ref:RequirePackage"
in the {\GAP} Reference Manual.

If {\GAP} cannot find a working binary, the call to `RequirePackage' will
fail.

If you know you have a working {\ANUPQ} binary, as well  as  a  correctly
installed {\ANUPQ} Share Package, it is possible to suppress  the  `Info'
messages by temporarily setting the `InfoLevel' of  `InfoWarning'  to  0,
and a duplicated semicolon will suppress the `true' result:

\beginexample
gap> SetInfoLevel(InfoWarning, 0); RequirePackage( "anupq" );;
gap> SetInfoLevel(InfoWarning, 1);
\endexample

If you want to load the {\ANUPQ} package by  default,  you  can  put  the
`RequirePackage' command into your `.gaprc'  file  (see  Section~"ref:The
.gaprc file" in the {\GAP} Reference Manual).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{The ANUPQData Record}

This section contains fairly technical details which may be skipped on an
initial reading.

\>`ANUPQData' V

is a {\GAP} record in which the essential data for  an  {\ANUPQ}  session
within {\GAP} is stored; its fields are:

\beginitems

\quad`binary' & the path of the {\ANUPQ} binary;

\quad`tmpdir' & the path of the temporary  directory  used  by  the  `pq'
binary and {\GAP} (i.e.~the directory in which all the  `pq''s  temporary
files are created) (also see "ANUPQDirectoryTemporary" below);

\quad`outfile'& the full path of the default `pq' output  file;

\quad`SPimages'& the full path of the file  `GAP_library'  to  which  the
`pq' binary writes its Standard Presentation images;

\quad`version'& the version of the current `pq' binary;

\quad`ni' & a data record used by non-interactive  functions  (see  below
and Chapter~"Non-interactive ANUPQ Functions"); and

\quad`io' & list of data records for `PqStart' (see below  and~"PqStart")
processes;

\enditems

Each time an interactive {\ANUPQ}  process  is  initiated  via  `PqStart'
(see~"PqStart"), an identifying number <ioIndex>  is  generated  for  the
interactive process and a record `ANUPQData.io[<ioIndex>]' with  some  or
all of the fields listed below is  created.  Whenever  a  non-interactive
function is called (see Chapter~"Non-interactive ANUPQ  Functions"),  the
record `ANUPQData.ni' is updated with fields that, if bound, have exactly
the same purpose as for a `ANUPQData.io[<ioIndex>]' record.

\beginitems

\quad`stream'& the  IOStream  opened  for  interactive  {\ANUPQ}  process
<ioIndex> or non-interactive {\ANUPQ} function;

\quad`group'& the group given as first argument to `PqStart';

\quad`workspace'& the workspace set for the `pq' process (either given as
a second argument to `PqStart', or set by default to 10000000);

\quad`menu'& the current menu of the `pq' process  (the  `pq'  binary  is
managed by various  menus,  the  details  of  which  the  user  shouldn't
normally need to know about -- the `menu' field remembers which menu  the
`pq' process is currently ``in'');

\quad`outfname' & is the file to which `pq' output is directed, which  is
always `ANUPQData.outfile', except when option `SetupFile' is used with a
non-interactive  function,  in  which   case   `outfname'   is   set   to
`"PQ_OUTPUT"';

\quad`pQpcp' & If this field is bound  it  is  a  record  containing  the
options used the last time that  `pq'  computed  a  pc  presentation  for
`group', while computing a $p$-quotient i.e.~if it is  bound  then  there
has been such a call. (It is used  mainly  to  avoid  re-computing  a  pc
presentation that's been done already, by functions that require  that  a
pc presentation is known to the `pq' binary.)

\quad`pQuotient'  &  This  is  set  to  the  value   returned   by   `Pq'
(see~"Pq!interactive") when called interactively, for process  <i>.  (The
field `pQepi' is also set at the same time.)

\quad`pQepi' & This is set  to  the  value  returned  by  `PqEpimorphism'
(see~"PqEpimorphism!interactive") when called interactively, for  process
<i>. (The field `pQuotient' is also set at the same time.)

\quad`SPpcp' & If this field is bound  it  is  a  record  containing  the
options used the last time that  `pq'  computed  a  pc  presentation  for
`group', while computing a standard presentation i.e.~if it is bound then
there has been such a call. (It is used mainly to avoid re-computing a pc
presentation that's been done already, by functions that require  that  a
pc presentation is known to the `pq' binary.)

\quad`SP' & This is set to the value returned by `PqStandardPresentation'
or `StandardPresentation' (see~"PqStandardPresentation!interactive") when
called interactively, for process <i>. (The field `SPepi' is also set  at
the same time.)

\quad`SPepi'   &   This   is   set   to    the    value    returned    by
`EpimorphismPqStandardPresentation' or  `EpimorphismStandardPresentation'
(see~"EpimorphismPqStandardPresentation!interactive")     when     called
interactively, for process <i>. (The field `SP' is also set at  the  same
time.)

\enditems

\>ANUPQDirectoryTemporary( <dir> ) F

calls the UNIX command `mkdir' to create <dir>, which must be  a  string,
and if successful a directory  object  for  <dir>  is  both  assigned  to
`ANUPQData.tmpdir' and returned. The field  `ANUPQData.outfile'  is  also
set to be a file in `ANUPQData.tmpdir', and on exit from {\GAP} <dir>  is
removed. Most users will never need  this  command;  by  default,  {\GAP}
typically   chooses   a   ``random''   subdirectory   of    `/tmp'    for
`ANUPQData.tmpdir' which may occasionally have  limits  on  what  may  be
written there. `ANUPQDirectoryTemporary' permits the  user  to  choose  a
directory (object) where one is not so limited.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Setting the Verbosity of ANUPQ via Info and InfoANUPQ}

\>`InfoANUPQ' V

The input to and the output from the `pq'  binary  is,  by  default,  not
displayed. However the user may choose to  see  some,  or  all,  of  this
input/output.   This   is   done   via   the   `Info'   mechanism    (see
Chapter~"ref:Info Functions" in the {\GAP} Reference  Manual).  For  this
purpose,  there  is  the  <InfoClass>  `InfoANUPQ'.  Each  line  of  `pq'
input/output is directed to a call to `Info' and will  be  displayed  for
the user to see if the `InfoLevel' of  `InfoANUPQ'  is  high  enough.  By
default, the `InfoLevel' of `InfoANUPQ' is 1, and it is recommended  that
you leave it at this level, or higher. Only messages which we think  that
the user will really want to see are directed to  `Info'  at  `InfoANUPQ'
level 1. To turn off *all* `InfoANUPQ'  messaging,  set  the  `InfoANUPQ'
level to 0.

Currently, information from the `pq' binary is directed to `Info' at five
`InfoANUPQ' levels: 1, 2, 3, 4 and 5. The command

\beginexample
gap> SetInfoLevel(InfoANUPQ, 2);
\endexample

enables the display of results from the `pq'  binary.

\beginexample
gap> SetInfoLevel(InfoANUPQ, 3);
\endexample

enables the display of all the input sent to the `pq'  binary,  behind  a
```ToPQ> ''' prompt (so that you can distinguish it from the output  from
the `pq' binary). Finally,

\beginexample
gap> SetInfoLevel(InfoANUPQ, 4);
\endexample

enables the display of all other output from the `pq' binary, namely  the
banner, menus, and the timing data printed when the  `pq'  binary  exits.
The fifth `InfoANUPQ' level is intended only for debugging purposes,  and
gives all partial results of commands read from an iostream.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Hints and Warnings regarding the use of Options}

Options are passed to the {\ANUPQ} interface functions in either  of  the
two usual mechanisms provided by {\GAP}, namely:

\beginlist

\item{--} options may be set globally using  the  function  `PushOptions'
(see Chapter~"ref:Options Stack" in the {\GAP} Reference Manual); or

\item{--} options may be appended to the argument list  of  any  function
call, separated by a colon from  the  argument  list  (see  "ref:Function
Calls" in the {\GAP} Reference Manual),  in  which  case  they  are  then
passed on recursively to any subsequent inner function call, which may in
turn have options of their own.

\endlist

Particularly,  when  one  is   using   the   interactive   functions   of
Chapter~"Interactive ANUPQ Functions",  one  should,  in  general,  avoid
using the global method of passing options. In fact,  it  is  recommended
that  prior  to  calling  `PqStart'  the  `OptionsStack'  be  empty.  The
essential  problem  with  seting  options  globally  using  the  function
`PushOptions' is that options pushed onto `OptionsStack',  in  this  way,
remain there until an explicit `PopOptions()' call is made.

In contrast, options passed in the usual way behind a colon  following  a
function's arguments (see "ref:Function Calls" in  the  {\GAP}  Reference
Manual) are local, and disappear from `OptionsStack' after  the  function
has executed successfully. However, if the function  does  *not*  execute
successfully, i.e.~it runs into error and the user `quit's the  resulting
`break' loop (see Section~"ref:Break  loops"  in  the  Reference  Manual)
rather than attempting to repair the problem and  typing  `return;'  then
the options of that function are *not* cleared  from  `OptionsStack'.  In
such cases, the user will generally want to:

\begintt
gap> ResetOptionsStack();
\endtt

(see~"ref:ResetOptionsStack" in the Reference Manual)  which  recursively
calls `PopOptions()' until `OptionsStack' is empty.

Nevertheless, a function, that is passed options after  the  colon,  will
also see any global options or any options passed down  recursively  from
functions calling that function, unless those options are over-ridden  by
options passed via the function. Note that duplication  of  option  names
for different programs may lead to  misinterpretations,  and  mis-spelled
options will not be ``seen''.

The   non-interactive   functions   of   Chapter~"Non-interactive   ANUPQ
Functions" that have `Pq' somewhere in their name provide an  alternative
method  of  passing  options  as  additional  arguments.  This  has   the
advantages that options can be abbreviated and mis-spelled  options  will
be trapped.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%E
