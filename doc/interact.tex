%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%A  interact.tex    ANUPQ documentation - interactive f'ns      Werner Nickel
%A                                                                Greg Gamble
%%
%A  @(#)$Id$
%%
%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Chapter{Interactive ANUPQ functions}

Here we describe  the  interactive  functions  defined  by  the  {\ANUPQ}
package, i.e.~the functions  that  manipulate  and  initiate  interactive
{\ANUPQ} processes. These are functions that extract  information  via  a
dialogue with a running `pq' process (process used in  the  UNIX  sense).
Occasionally, a user needs the ``next step''; the functions  provided  in
this chapter make use of data from previous steps retained  by  the  `pq'
binary, thus allowing the user to interact with the `pq' binary like  one
can when one uses the `pq' binary as a  stand-alone  (see~`guide.dvi'  in
the `standalone-doc' directory).

An  interactive  {\ANUPQ}  process  is  initiated  by   `PqStart'   and
terminated  via  `PqQuit';   these   functions   are   described   in
Section~"Starting and Stopping Interactive ANUPQ Processes".

Each interactive {\ANUPQ} function that manipulates  an  already  started
interactive {\ANUPQ} process, has a form where the first argument is  the
integer <i> returned by the initiating `PqStart' command,  and  a  second
form with one argument fewer (where the integer <i> is  discovered  by  a
default mechanism, namely by determining the least integer <i> for  which
there is a currently active interactive {\ANUPQ} process). We  will  thus
commonly say that ``for  the  <i>th  (or  default)  interactive  {\ANUPQ}
process'' a certain function performs a given action. In each case, it is
an error if <i> is not the index of an  active  interactive  process,  or
there are no current active interactive processes.

*Notes*: 
The global method of passing options (via `PushOptions'), should  not  be
used with any of the interactive functions. In fact,  the  `OptionsStack'
should be empty at the time any of the interactive functions is called.

On `quit'ting {\GAP}, `PqQuitAll();' is executed,  which  terminates  all
active interactive  {\ANUPQ}  processes.  If  {\GAP}  is  killed  without
`quit'ting, before all interactive  {\ANUPQ}  processes  are  terminated,
*zombie* processes (still living *child* processes whose  *parents*  have
died), will result. Since zombie processes do consume resources, in  such
an event, the responsible computer user should  seek  out  and  kill  the
still living `pq' children (e.g.~by piping the  output  of  a  `ps'  with
appropriate options, usually `aux' or `ef', to `grep  pq',  to  find  the
process ids, and then using `kill'; try `man ps' and `man kill' if  these
hints are unhelpful).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Starting and Stopping Interactive ANUPQ Processes}

\>PqStart( <G>, <workspace> : <options> ) F
\>PqStart( <G> : <options> ) F
\>PqStart( <workspace> : <options> ) F
\>PqStart(: <options> ) F

activate an iostream for an interactive {\ANUPQ} process (i.e.  `PqStart'
starts up a `pq' binary process and opens a {\GAP} iostream  to  ``talk''
to that process) and returns an integer <i> that can be used to  identify
that process. The argument <G>, if given, should be an *fp group* or  *pc
group* that the user  intends  to  manipute  using  interactive  {\ANUPQ}
functions. If `PqStart' is given an integer argument <workspace> then the
`pq' binary is started up with a workspace (an  integer  array)  of  size
<workspace> (i.e. $4 \times <workspace>$ bytes in a 32-bit  environment);
otherwise, the `pq' binary sets a default workspace of $10000000$.

The  only  <options>  currently  recognised  by  `PqStart'  are  `Prime',
`Exponent' and  `Relators'  (see  Chapter~"ANUPQ  options"  for  detailed
descriptions of these options)  and  if  provided  they  are  essentially
global for the interactive {\ANUPQ} process, except that any  interactive
function interacting with the process and passing new  values  for  these
options will over-ride the global values.

\>PqQuit( <i> ) F
\>PqQuit() F

closes the stream of the <i>th or default  interactive  {\ANUPQ}  process
and unbinds its `ANUPQData.io' record.

*Note:*
It can happen that the `pq' binary process, and hence the {\GAP} iostream
assigned to communicate with it, can  die,  e.g.~by  the  user  typing  a
`Ctrl-C' while the `pq' binary process is engaged in a long  calculation.
`IsPqProcessAlive' (see~"IsPqProcessAlive")  is  provided  to  check  the
status of the {\GAP} iostream (and hence the status of  the  `pq'  binary
process it was communicating with).

\>PqQuitAll() F

is provided  as  a  convenience,  to  terminate  all  active  interactive
{\ANUPQ} processes with a single command. It is equivalent  to  executing
`PqQuit(<i>)'  for  all  active  interactive   {\ANUPQ}   processes   <i>
(see~"PqQuit").

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Interactive ANUPQ Process Utility Functions}

\>PqProcessIndex( <i> ) F
\>PqProcessIndex() F

With argument <i>, which must be  a  positive  integer,  `PqProcessIndex'
returns <i> if it corresponds to an active interactive process, or raises
an error. With no arguments it returns  the  default  active  interactive
process or returns `fail' and  emits  a  warning  message  to  `Info'  at
`InfoANUPQ' or `InfoWarning' level 1.

*Note:*
Essentially,  an  interactive  {\ANUPQ}  process  <i>  is  ``active''  if
`ANUPQData.io[<i>]' is bound (i.e.~we still have  some  data  telling  us
about it). Also see~"PqStart".

\>PqProcessIndices() F

returns the list of integer indices of all  active  interactive  {\ANUPQ}
processes (see~"PqProcessIndex" for the meaning of ``active'').

\>IsPqProcessAlive( <i> ) F
\>IsPqProcessAlive() F

return  `true'  if  the  {\GAP}  iostream  of  the  <i>th  (or   default)
interactive {\ANUPQ} process started  by  `PqStart'  is  alive  (i.e.~can
still be written to), or `false', otherwise. (See the notes for~"PqStart"
and~"PqQuit".)

\atindex{interruption}{@interruption of an interactive ANUPQ process}
If the user does not yet have a  `gap>'  prompt  then  usually  the  `pq'
binary is still away doing something and an {\ANUPQ}  interface  function
is still waiting for a reply. Typing a `Ctrl-C'  (i.e.~holding  down  the
`Ctrl' key and typing `c') will stop the waiting and send {\GAP}  into  a
`break'-loop, from which one has no option but to `quit;'. The typing  of
`Ctrl-C', in such a  circumstance,  usually  causes  the  stream  of  the
interactive  {\ANUPQ}  process  to  die;  to  check   this   we   provide
`IsPqProcessAlive' (see~"IsPqProcessAlive").

The {\GAP} iostream of an interactive {\ANUPQ} process will also  die  if
the {\ANUPQ} binary has a segmentation fault. We do hope that this  never
happens to you, but if it does and the failure is reproducible, then it's
a bug and we'd like to know about it. Please read the `README' that comes
with the {\ANUPQ} package to find out what to include in a bug report and
who to email it to.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Interactive Versions of Non-interactive ANUPQ Functions}

\>Pq( <i> : <options> )!{interactive} F
\>Pq( : <options> )!{interactive} F

return, for the fp or pc  group  of  the  <i>th  or  default  interactive
{\ANUPQ} process (let us call it <F>), the $p$-quotient of <F>  specified
by <options>, as a pc group; <F> must  previously  have  been  given  (as
first argument) to `PqStart' to start the  interactive  {\ANUPQ}  process
(see~"PqStart"). Following the colon <options>  is  a  selection  of  the
options  listed  for  the  non-interactive  `Pq'   function   (see~"Pq"),
separated by commas like  record  components  (see  Section~"ref:function
call with options" in the  {\GAP}  Reference  Manual),  except  that  the
options `SetupFile' or `PqWorkspace' are ignored by the interactive  `Pq'
and `RedoPcp' is an  option  only  recognised  by  the  interactive  `Pq'
i.e.~the  following  options  are  recognised  by  the  interactive  `Pq'
function:

\beginlist%unordered

\atindex{option Prime}{@option \noexpand`Prime'}
\item{}`Prime := <p>'

\atindex{option ClassBound}{@option \noexpand`ClassBound'}
\item{}`ClassBound := <n>'

\atindex{option Exponent}{@option \noexpand`Exponent'}
\item{}`Exponent := <n>'

\atindex{option Relators}{@option \noexpand`Relators'}
\item{}`Relators := <rels>'

\atindex{option Metabelian}{@option \noexpand`Metabelian'}
\item{}`Metabelian'

\atindex{option GroupName}{@option \noexpand`GroupName'}
\item{}`GroupName := <name>'

\atindex{option OutputLevel}{@option \noexpand`OutputLevel'}
\item{}`OutputLevel := <n>'

\atindex{option RedoPcp}{@option \noexpand`RedoPcp'}
\item{}`RedoPcp'

\endlist

Detailed descriptions of the above options may be found in Chapter~"ANUPQ
options".

As a minimum the `Pq' function  *must*  have  a  value  for  the  `Prime'
option, though `Prime' need not be  passed  again  in  the  case  it  has
previously been provided, e.g. to `PqStart' (see~"PqStart") when starting
the interactive process.

The behaviour of the interactive `Pq' function  depends  on  the  current
state of the pc presentation stored by the `pq' binary:

\beginlist%ordered

\item{1.}
If no pc presentation has yet been computed (the case  immediately  after
the `PqStart' call initiating the process) then the quotient group of the
input group of the process of largest lower exponent-<p> class bounded by
the  value  of  the  `ClassBound'  option  (see~"option  ClassBound")  is
returned.

\item{2.}
If the current pc  presentation  of  the  process  was  determined  by  a
previous call to `Pq' or `PqEpimorphism', and  the  current  call  has  a
larger value `ClassBound' then the  class  is  extended  as  much  as  is
possible and the quotient group of the input group of the process of  the
new lower exponent-<p> class is returned.

\item{3.}
If the current pc  presentation  of  the  process  was  determined  by  a
previous call to `PqPCover'  then  a  consistent  pc  presentation  of  a
quotient for the current class is determined before proceeding as in 2.

\item{4.}
If the `RedoPcp' option  is  supplied  the  current  pc  presentation  is
scrapped, all options must be re-supplied (in particular, `Prime'  *must*
be supplied) and then the `Pq' function proceeds as in 1.

\endlist

See Section~"Attributes and a Property for fp and pc  p-groups"  for  the
attributes   and   property   `NuclearRank',   `MultiplicatorRank'    and
`IsCapable' which may be applied to the group returned by `Pq'.

The following is one of the examples for the non-interactive `Pq'  redone
with the interactive version. Also, we set the option `OutputLevel' to  1
(see~"option   Outputlevel"), in order to see the orders of the quotients
of all the classes determined, and we set  the  `InfoANUPQ'  level  to  2
(see~"InfoANUPQ"), so that we catch the timing information.

\beginexample
gap> F := FreeGroup("a", "b");; a := F.1;; b := F.2;;
gap> G := F / [a^4, b^4];
<fp group on the generators [ a, b ]>
gap> PqStart(G);
1
gap> SetInfoLevel(InfoANUPQ, 2); #To see timing information               
gap> Pq(: Prime := 2, ClassBound := 3, OutputLevel := 1 );
#I  Lower exponent-2 central series for <grp>
#I  Group: <grp> to lower exponent-2 central class 1 has order 2^2
#I  Group: <grp> to lower exponent-2 central class 2 has order 2^5
#I  Group: <grp> to lower exponent-2 central class 3 has order 2^8
#I  Computation of presentation took 0.00 seconds
<pc group of size 256 with 8 generators>
\endexample

\>PqEpimorphism( <i> : <options> )!{interactive} F
\>PqEpimorphism( : <options> )!{interactive} F

return, for the fp or pc  group  of  the  <i>th  or  default  interactive
{\ANUPQ} process (let us call it <F>), an epimorphism from <F>  onto  the
$p$-quotient of <F> specified by <options>; <F> must previously have been
given (as first argument) to `PqStart' to start the interactive  {\ANUPQ}
process (see~"PqStart"). Since the underlying interactions with the  `pq'
binary effected by the interactive `PqEpimorphism' are identical to those
effected  by  the  interactive  `Pq',  everything  said   regarding   the
requirements   and   behaviour   of   the   interactive   `Pq'   function
(see~"Pq!interactive")   is   also   the   case   for   the   interactive
`PqEpimorphism'.

*Note:*
See Section~"Attributes and a Property for fp and pc  p-groups"  for  the
attributes   and   property   `NuclearRank',   `MultiplicatorRank'    and
`IsCapable' which may be applied to the image group  of  the  epimorphism
returned by `PqEpimorphism'.

\>PqPCover( <i> : <options> )!{interactive} F
\>PqPCover( : <options> )!{interactive} F

return, for the fp or pc  group  of  the  <i>th  or  default  interactive
{\ANUPQ} process, the $p$-covering group of the $p$-quotient $p$-quotient
`Pq(<i> : <options>)' or `Pq(: <options>)', modulo the following:

\beginlist%ordered

\item{1.}
If no pc presentation has yet been computed (the case  immediately  after
the `PqStart' call initiating the process)  and  the  group  <F>  of  the
process is already a $p$-group, in the sense that  `HasIsPGroup(<F>)  and
IsPGroup(<F>)' is `true', then

\endlist
\beginitems

`Prime'& 
defaults to `PrimePGroup(<F>)', if not supplied and  `HasPrimePGroup(<F>)
= true'; and

`ClassBound'&
defaults to `PrimePGroup(<F>)' if `HasPClassPGroup(<F>) =  true'  if  not
supplied, or to the usual default of 63, otherwise.

\enditems
\beginlist%ordered{1}{2}

\item{2.}
If a pc presentation has been computed and none of <options> is `RedoPcp'
or if no pc presentation has yet been computed but 1. does not apply then
`PqPCover(<i> : <options>);' is equivalent to:

\){\kernttindent}Pq(<i> : <options>);
\){\kernttindent}PqPCover(<i>);

\item{3.}
If the `RedoPcp' option  is  supplied  the  current  pc  presentation  is
scrapped, and `PqPCover'  proceeds  as  in  1.  or  2.  but  without  the
`RedoPcp' option.

\endlist

\index{automorphisms!of $p$-groups}
\>PqStandardPresentation( <i>, <p> : <options> )!{interactive} F
\>PqStandardPresentation( <p> : <options> )!{interactive} F
\>PqStandardPresentation( <i>, <Q> : <options> )!{interactive} F
\>PqStandardPresentation( <Q> : <options> )!{interactive} F
\>StandardPresentation( <i>, <p> : <options> )!{interactive} M
\>StandardPresentation( <p> : <options> )!{interactive} M
\>StandardPresentation( <i>, <Q> : <options> )!{interactive} M
\>StandardPresentation( <Q> : <options> )!{interactive} M

For the fp or pc group <F> of the <i>th or default  interactive  {\ANUPQ}
process and either a prime <p> or  a  pc  <p>-group  <Q>,  the  functions
return the <p>-quotient  of  <F>  specified  by  the  last  argument  and
<options>, as an fp group which has a standard  presentation.  The  group
<F> must have been given (as first argument) to `PqStart'  to  start  the
interactive {\ANUPQ} process (see~"PqStart"). If the user supplies  a  pc
group <Q> which must be a $p$-quotient of <F>, the package {\AutPGrp}  is
called automatically to compute the automorphism group of <Q>;  an  error
will occur that asks the user to install the package  {\AutPGrp}  if  the
automorphism group cannot be computed.

Following the colon, <options> is a selection of  the  options  from  the
following list, separated by commas like record components; this list  is
the same as for  `PqStandardPresentation'  except  for  the  omission  of
options `SetupFile' and `PqWorkspace' (see~"PqStandardPresentation").

\beginlist%unordered

\atindex{option ClassBound}{@option \noexpand`ClassBound'}
\item{}`ClassBound := <n>'

\atindex{option Exponent}{@option \noexpand`Exponent'}
\item{}`Exponent := <n>'

\atindex{option Metabelian}{@option \noexpand`Metabelian'}
\item{}`Metabelian'

\atindex{option GroupName}{@option \noexpand`GroupName'}
\item{}`GroupName := <name>'

\atindex{option OutputLevel}{@option \noexpand`OutputLevel'}
\item{}`OutputLevel := <n>'

\atindex{option StandardPresentationFile}%
{@option \noexpand`StandardPresentationFile'}
\item{}`StandardPresentationFile := <filename>'

\endlist

Detailed descriptions of the above options may be found in Chapter~"ANUPQ
options".

*Note:*
The  attributes  and  property  `NuclearRank',  `MultiplicatorRank'   and
`IsCapable' are set for the group returned by `PqStandardPresentation' or
`StandardPresentation' (see Section~"Attributes and a Property for fp and  
pc p-groups").

Taking  one  of  the  examples  for  the   non-interactive   version   of
`StandardPresentation'  (see~"StandardPresentation")  that  required  two
separate calls to the `pq' binary, we now show how, with the  interactive
version of `StandardPresentation',  it  can  be  done  by  setting  up  a
dialogue with just the one `pq' process:

\beginexample
gap> F4 := FreeGroup( "a", "b", "c", "d" );;
gap> a := F4.1;; b := F4.2;; c := F4.3;; d := F4.4;;
gap> G4 := F4 / [ b^4, b^2 / Comm(Comm (b, a), a), d^16,
>                 a^16 / (c * d), b^8 / (d * c^4) ];
<fp group on the generators [ a, b, c, d ]>
gap> SetInfoLevel(InfoANUPQ, 1); #Only essential Info please
gap> PqStart(G4); #Start a new interactive process for a new group
2
gap> K := Pq( 2 : Prime := 2, ClassBound := 1 ); #`pq' process no. is 2
<pc group of size 4 with 2 generators>
gap> StandardPresentation( 2, K : ClassBound := 14 );
<fp group with 53 generators>
\endexample

\>EpimorphismPqStandardPresentation( <i>, <p> : <options> )!{interactive} F
\>EpimorphismPqStandardPresentation( <p> : <options> )!{interactive} F
\>EpimorphismPqStandardPresentation( <i>, <Q> : <options> )!{interactive} F
\>EpimorphismPqStandardPresentation( <Q> : <options> )!{interactive} F
\>EpimorphismStandardPresentation( <i>, <p> : <options> )!{interactive} M
\>EpimorphismStandardPresentation( <p> : <options> )!{interactive} M
\>EpimorphismStandardPresentation( <i>, <Q> : <options> )!{interactive} M
\>EpimorphismStandardPresentation( <Q> : <options> )!{interactive} M

Each of the above functions accepts the same arguments and options as the
interactive           form           of            `StandardPresentation'
(see~"StandardPresentation!interactive") and returns an epimorphism  from
the fp or pc group <F> of  the  <i>th  or  default  interactive  {\ANUPQ}
process  onto  the  finitely  presented  group  given   by   a   standard
presentation, i.e.~if <S> is the standard presentation computed  for  the
$p$-quotient     of     <F>      by      `StandardPresentation'      then
`EpimorphismStandardPresentation' returns the epimorphism from <F> to the
group with presentation <S>. The group <F> must have been given (as first
argument)  to  `PqStart'  to  start  the  interactive  {\ANUPQ}   process
(see~"PqStart").

*Note:*
The  attributes  and  property  `NuclearRank',  `MultiplicatorRank'   and
`IsCapable' are set for the image group of the  epimorphism  returned  by
`EpimorphismPqStandardPresentation' or  `EpimorphismStandardPresentation'
(see Section~"Attributes and a Property for fp and pc p-groups").

Taking        our         earlier         non-interactive         example
(see~"EpimorphismPqStandardPresentation")   we   again   illustrate   how
something that required two separate calls to the `pq' binary can now  be
achieved with a dialogue with just one `pq' process.

\beginexample
gap> F := FreeGroup(6, "F");
<free group on the generators [ F1, F2, F3, F4, F5, F6 ]>
gap> x := F.1;; y := F.2;; z := F.3;; w := F.4;; a := F.5;; b := F.6;;
gap> R := [x^3 / w, y^3 / w * a^2 * b^2, w^3 / b,
>          Comm (y, x) / z, Comm (z, x), Comm (z, y) / a, z^3 ];;
gap> Q := F / R;
<fp group on the generators [ F1, F2, F3, F4, F5, F6 ]>
gap> PqStart(Q); #Start a new interactive process for a new group       
3
gap> G := Pq( 3 : Prime := 3, ClassBound := 3 );
<pc group of size 729 with 6 generators>
gap> phi := EpimorphismStandardPresentation( procId, 3 : ClassBound := 3 );
[ F1, F2, F3, F4, F5, F6 ] -> [ f1^2*f2*f4^2*f6, f1^2*f2^2*f3^2*f4*f5, f3^2, 
  f4^2*f6^2, f5^2, f6^2 ]
gap> Size( Image(phi) );
729
\endexample

\>PqDescendants( <i> : <options> )!{interactive} F
\>PqDescendants( : <options> )!{interactive} F

returns for the pc  group  <G>,  of  the  <i>th  or  default  interactive
{\ANUPQ} process, which must be of prime power order with a confluent  pc
presentation (see~"ref:IsConfluent!for pc groups" in the {\GAP} Reference
Manual), a list of descendants (pc groups) of <G>. The group <G>  is  the
group given as first argument  to  `PqStart'  to  start  the  interactive
{\ANUPQ}  process  (see~"PqStart").  Following  the  colon  <options>   a
selection of the options listed for the  non-interactive  `PqDescendants'
function (see~"PqDescendants") should be given, separated by commas  like
record components (see Section~"ref:function call with  options"  in  the
{\GAP}  Reference  Manual),  except  that  the  options  `SetupFile'   or
`PqWorkspace' are ignored by the  interactive  `PqDescendants',  i.e.~the
following options  are  recognised  by  the  interactive  `PqDescendants'
function:

\beginlist%unordered

\atindex{option ClassBound}{@option \noexpand`ClassBound'}
\item{}`ClassBound := <n>'

\atindex{option Relators}{@option \noexpand`Relators'}
\item{}`Relators := <rels>'

\atindex{option OrderBound}{@option \noexpand`OrderBound'}
\item{}`OrderBound := <n>'

\atindex{option StepSize}{@option \noexpand`StepSize'}
\item{}`StepSize := <nOrlist>'

\atindex{option RankInitialSegmentSubgroups}%
{@option \noexpand`RankInitialSegmentSubgroups'}
\item{}`RankInitialSegmentSubgroups := <n>'

\atindex{option SpaceEfficient}{@option \noexpand`SpaceEfficient'}
\item{}`SpaceEfficient'

\atindex{option CapableDescendants}{@option \noexpand`CapableDescendants'}
\item{}`CapableDescendants'

\atindex{option AllDescendants}{@option \noexpand`AllDescendants'}
\item{}`AllDescendants := false'

\atindex{option Exponent}{@option \noexpand`Exponent'}
\item{}`Exponent := <n>'

\atindex{option Metabelian}{@option \noexpand`Metabelian'}
\item{}`Metabelian'

\atindex{option GroupName}{@option \noexpand`GroupName'}
\item{}`GroupName := <name>'

\atindex{option SubList}{@option \noexpand`SubList'}
\item{}`SubList := <sub>'

\atindex{option BasicAlgorithm}{@option \noexpand`BasicAlgorithm'}
\item{}`BasicAlgorithm'

\atindex{option CustomiseOutput}{@option \noexpand`CustomiseOutput'}
\item{}`CustomiseOutput := <rec>'

\endlist

*Notes:*
The function `PqDescendants' uses the automorphism group of <G> which  it
computes via the package {\AutPGrp}. If this package is not installed  an
error may be raised. If the automorphism group of <G>  is  insoluble  the
`pq' binary will call {\GAP} together with  the  {\AutPGrp}  package  for
certain orbit-stabilizer calculations.  (So,  in  any  case,  one  should
ensure the {\AutPGrp} package is installed.)

The  attributes  and  property  `NuclearRank',  `MultiplicatorRank'   and
`IsCapable'  are  set  for  each  group   of   the   list   returned   by
`PqDescendants' (see Section~"Attributes and a Property  for  fp  and  pc
p-groups").

Let us now repeat the examples previously given for  the  non-interactive
`PqDescendants',  but  this  time  with  the   interactive   version   of
`PqDescendants':

\beginexample
gap> F := FreeGroup( "a", "b" );; a := F.1;; b := F.2;;
gap> G := PcGroupFpGroup( F / [ a^2, b^2, Comm(b, a) ] );
<pc group of size 4 with 2 generators>
gap> PqStart(G);
4
gap> #This is now the 4th interactive process running
gap> des := PqDescendants( 4 : OrderBound := 6, ClassBound := 5 );;
gap> Length(des);
83
gap> List(des, Size);
[ 8, 8, 8, 16, 16, 16, 32, 16, 16, 16, 16, 16, 32, 32, 64, 64, 32, 32, 32, 
  32, 32, 32, 32, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 32, 32, 32, 32, 
  64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 32, 32, 32, 32, 32, 64, 64, 64, 
  64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 
  64, 64, 64, 64, 64, 64, 64 ]
gap> List(des, d -> Length( PCentralSeries( d, 2 ) ) - 1 );
[ 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
  3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 
  4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 
  4, 4, 4, 5, 5, 5, 5, 5 ]
\endexample

In the second example we compute all  capable descendants of order  27 of
the  elementary abelian group of order 9.  

\beginexample
gap> F := FreeGroup( 2, "g" );;                                 
gap> G := PcGroupFpGroup( F / [ F.1^3, F.2^3, Comm(F.1, F.2) ] );
<pc group of size 9 with 2 generators>
gap> PqStart(G); #This will now be the 5th interactive process running
5
gap> des := PqDescendants( 5 : OrderBound := 3, ClassBound := 2,
>                              CapableDescendants );
[ <pc group of size 27 with 3 generators>, 
  <pc group of size 27 with 3 generators> ]
gap> List(des, d -> Length( PCentralSeries( d, 3 ) ) - 1 );
[ 2, 2 ]
gap> # For comparison let us now compute all descendants
gap> # (using the non-interactive Pq function)
gap> PqDescendants( G : OrderBound := 3, ClassBound := 2);
[ <pc group of size 27 with 3 generators>, 
  <pc group of size 27 with 3 generators>, 
  <pc group of size 27 with 3 generators> ]
\endexample

In  the  third  example,  we  compute  all  capable  descendants  of  the
elementary abelian group of order  $5^2$ which have exponent-$5$ class at
most $3$, exponent $5$, and are metabelian.

\beginexample
gap> F := FreeGroup( 2, "g" );;
gap> G := PcGroupFpGroup( F / [ F.1^5, F.2^5, Comm(F.2, F.1) ] );
<pc group of size 25 with 2 generators>
gap> PqStart(G); #This will now be the 6th interactive process running
6
gap> des := PqDescendants( 6 : Metabelian, ClassBound := 3,
>                              Exponent := 5, CapableDescendants );
[ <pc group of size 125 with 3 generators>, 
  <pc group of size 625 with 4 generators>, 
  <pc group of size 3125 with 5 generators> ]
gap> List(des, d -> Length( PCentralSeries( d, 5 ) ) - 1 );
[ 2, 3, 3 ]
gap> List(des, d -> Length( DerivedSeries( d ) ) );
[ 3, 3, 3 ]
gap> List(des, d -> Maximum( List( Elements(d), Order ) ) );
[ 5, 5, 5 ]
\endexample

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Low-level Interactive ANUPQ Functions based on menu items of the
pq binary}

*WARNING!! MOST OF THE FOLLOWING FUNCTIONS HAVE FEW SAFEGUARDS ... WE'RE
 WORKING ON IT, BUT IT'S USE AT YOUR OWN RISK AT THE MOMENT ... IF YOU
 DON'T DEFINE A PC PRESENTATION BEFORE DOING CERTAIN COMMANDS, THE pq
 BINARY WILL PROBABLY DIE ON YOU*

The `pq' binary has 5 menus, the details of which  the  reader  will  not
normally need to know, but if she wishes to know the details they may  be
found in the standalone manual: `guide.dvi'.  Both  `guide.dvi'  and  the
`pq' binary refer to the items of these 5 menus as ``options'', which  do
*not* correspond in any way to the options used  by  any  of  the  {\GAP}
functions that interface with the `pq' binary.

*General commands*

The following commands either use a  menu  item  from  whatever  menu  is
``current'' for the `pq' binary, or have general application and are  not
associated with just one menu item of the `pq' binary.

\>PqFactoredOrder( <i> ) F
\>PqFactoredOrder() F

for the <i>th or default interactive {\ANUPQ} process, return an estimate
of the factored order of the lower exponent  $p$-class  quotient  of  the
group currently determined by the process as a list `[<p>, <n> ]'.

*Note:* The order of each $p$-class quotient is taken as $p^n$ where  $n$
is the number of generators for the class; this may be  an  over-estimate
if tails have been added and the necessary consistency  checks,  relation
collections, exponent law checks  and  redundant  generator  eliminations
have not yet been done for a class.

\>PqOrder( <i> ) F
\>PqOrder() F

for the <i>th or default interactive {\ANUPQ} process, return an estimate
of the order of the  lower  exponent  $p$-class  quotient  of  the  group
currently determined by the process.

*Note:* The order of each $p$-class quotient is taken as $p^n$ where  $n$
is the number of generators for the class; this may be  an  over-estimate
if tails have been added and the necessary consistency  checks,  relation
collections, exponent law checks  and  redundant  generator  eliminations
have not been done for a class.

\>PqPClass( <i> ) F
\>PqPClass() F

for the <i>th or default interactive {\ANUPQ} process, return  the  lower
exponent $p$-class of the quotient  group  currently  determined  by  the
process.

\>PqNrPcGenerators( <i> ) F
\>PqNrPcGenerators() F

for the <i>th or default interactive {\ANUPQ} process, return the  number
of pc generators of the lower exponent $p$-class quotient  of  the  group
currently determined by the process.

\>PqWeight( <i>, <j> ) F
\>PqWeight( <j> ) F

for the <i>th or default interactive {\ANUPQ} process, return the  weight
of the <j>th pc generator of the lower exponent $p$-class quotient of the
group currently determined by the process, or `fail' if there is no  such
numbered pc generator.

\>PqCurrentGroup( <i> ) F
\>PqCurrentGroup() F

for the <i>th or default interactive {\ANUPQ} process, return  the  group
whose pc presentation is determined by the process as a {\GAP}  pc  group
(either a lower exponent $p$-class quotient of the  start  group  or  the
$p$-cover of such a quotient).

*Notes:*
See Section~"Attributes and a Property for fp and pc  p-groups"  for  the
attributes   and   property   `NuclearRank',   `MultiplicatorRank'    and
`IsCapable'  which  may   be   applied   to   the   group   returned   by
`PqCurrentGroup'.

\>PqDisplayPcPresentation( <i> [: OutputLevel := <lev> ]) F
\>PqDisplayPcPresentation([: OutputLevel := <lev> ]) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to display the pc presentation of  the  lower  exponent  $p$-class
quotient of the group currently determined by the process.

Except if the last command communicating  with  the  `pq'  binary  was  a
$p$-group generation command (for which there is only  a  verbose  output
level), to set the amount of information this command  displays  you  may
wish  to  call  `PqSetOutputLevel'  first  (see~"PqSetOutputLevel"),   or
equivalently pass the option `OutputLevel' (see~"option OutputLevel").

*Note:*
For  those  familiar  with  the  `pq'  binary,  `PqDisplayPcPresentation'
performs menu item 4 of the current menu of the `pq' binary.

\>PqSetOutputLevel( <i>, <lev> ) F
\>PqSetOutputLevel( <lev> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to set the output level of the `pq' binary to <lev>.

*Note:* For those  familiar  with  the  `pq'  binary,  `PqSetOutputLevel'
performs menu item 5 of the main (or advanced) $p$-Quotient menu, or  the
Standard Presentation menu.

*Commands from the Main $p$-Quotient menu*

\>PqPcPresentation( <i> : <options> ) F
\>PqPcPresentation( : <options> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to compute the pc presentation  of  the  quotient  (determined  by
<options>) of the group of the process, which for process <i>  is  stored
as `ANUPQData.io[<i>].group'.

The  possible  <options>  are  the  same  as  for  the  interactive  `Pq'
(see~"Pq!interactive")   function,   namely:    `Prime',    `ClassBound',
`Exponent', `Relators', `GroupName', `Metabelian' and `OutputLevel'  (see
Chapter~"ANUPQ options" for a detailed description  for  these  options).
The option `Prime' is required  unless  already  provided  to  `PqStart'.
Also, option `ClassBound' *must* be supplied.

*Notes* 

The pc presentation is held by the `pq' binary. There is no output  of  a
{\GAP} pc group; see~`PqCurrentGroup' ("PqCurrentGroup") if you need  the
corresponding {\GAP} pc group.

For those familiar with the `pq' binary, `PqPcPresentation' performs menu
item 1 of the main $p$-Quotient menu.

\>PqSavePcPresentation( <i>, <filename> ) F
\>PqSavePcPresentation( <filename> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to save the pc presentation previously computed for  the  quotient
of the group of that process to the file with  name  <filename>.  If  the
first character of the  string  <filename>  is  not  `/',  <filename>  is
assumed to be the path of a writable file relative to  the  directory  in
which {\GAP} was started.

*Note:* For those familiar with the `pq'  binary,  `PqSavePcPresentation'
performs menu item 2 of the main $p$-Quotient menu.

\>PqRestorePcPresentation( <i>, <filename> ) F
\>PqRestorePcPresentation( <filename> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to restore the pc presentation previously saved to <filename>.  If
the first character of the string <filename> is not  `/',  <filename>  is
assumed to be the path of a readable file relative to  the  directory  in
which {\GAP} was started.

*Note:*
For  those  familiar  with  the  `pq'  binary,  `PqRestorePcPresentation'
performs menu item 3 of the main $p$-Quotient menu.

\>PqNextClass( <i> [: QueueFactor ]) F
\>PqNextClass([: QueueFactor ]) F

for the <i>th or default interactive {\ANUPQ} process, direct the `pq' to
calculate the next class of `ANUPQData.io[<i>].group'.

\atindex{option QueueFactor}{@option \noexpand`QueueFactor'}
`PqNextClass'  accepts  the  option   `QueueFactor'   (see   also~"option
QueueFactor") which should be a positive integer  if  automorphisms  have
been previously supplied. If the `pq' binary requires a queue factor  and
none is supplied via the option `QueueFactor' a default of 15 is taken.

*Notes*

The single command: `PqNextClass(<i>);' is equivalent to executing

\){\kernttindent}PqSetupTablesForNextClass(<i>);
\){\kernttindent}PqTails(<i>, 0);
\){\kernttindent}PqDoConsistencyChecks(<i>, 0, 0);
\){\kernttindent}PqEliminateRedundantGenerators(<i>);
\){\kernttindent}PqCollectDefiningRelations(<i>);
\){\kernttindent}PqDoExponentChecks(<i>);
\){\kernttindent}PqEliminateRedundantGenerators(<i>);

For those familiar with the `pq' binary, `PqNextClass' performs menu item
6 of the main $p$-Quotient menu.

\>PqComputePCover( <i> ) F
\>PqComputePCover() F

for the <i>th or default interactive {\ANUPQ} process, direct the `pq' to
compute the $p$-covering group of `ANUPQData.io[<i>].group'.

*Notes*

The single command: `PqComputePCover(<i>);' is equivalent to executing

\){\kernttindent}PqSetupTablesForNextClass(<i>);
\){\kernttindent}PqTails(<i>, 0);
\){\kernttindent}PqDoConsistencyChecks(<i>, 0, 0);
\){\kernttindent}PqEliminateRedundantGenerators(<i>);

For those familiar with the `pq' binary, `PqComputePCover' performs  menu
item 7 of the main $p$-Quotient menu.

*Commands from the Advanced $p$-Quotient menu*

\>PqCollect( <i>, <word> ) F
\>PqCollect( <word> ) F

for the <i>th or default interactive {\ANUPQ} process, instruct the  `pq'
binary to do a collection on <word>, a string representing the product of
pc generators, e.g. `"x3*x2*x1"'.

*FORM OF* <word> *WILL CHANGE*

*Note:* For those familiar with the  `pq'  binary,  `PqCollect'  performs
menu item 1 of the Advanced $p$-Quotient menu.

\>PqSolveEquation( <i>, <a>, <b> ) F
\>PqSolveEquation( <a>, <b> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to solve $<a> * <x> = <b>$ for <x>, where <a> and <b> are words in
the pc generators.

*Note:* 
For those familiar  with  the  `pq'  binary,  `PqSolveEquation'  performs
menu item 2 of the Advanced $p$-Quotient menu.

\>PqCommutator( <i>, <words>, <pow> ) F
\>PqCommutator( <words>, <pow> ) F

for the <i>th or default interactive {\ANUPQ} process, direct  the  `pq'
binary to compute the left normed commutator of the list <words> of words
in the pc generators raised to the integer power <pow>.

*Note:*
For those familiar with the `pq'  binary,  `PqCommutator'  performs  menu
item 3 of the Advanced $p$-Quotient menu.

\>PqSetupTablesForNextClass( <i> ) F
\>PqSetupTablesForNextClass() F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary  to  set  up  tables  for  the  next  class.  As  as  side-effect,
after   `PqSetupTablesForNextClass(<i>)'   the    value    returned    by
`PqPClass(<i>)' will be one more than it was previously.

*Note:* 
For those familiar  with  the  `pq'  binary,  `PqSetupTablesForNextClass'
performs menu item 6 of the Advanced $p$-Quotient menu.

\>PqTails( <i>, <weight> ) F
\>PqTails( <weight> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to compute and add tails of weight <weight> if <weight> is in  the
integer range `[2 .. PqPClass(<i>)]' (assuming <i> is the number  of  the
process, even in the default case) or for all weights if `<weight> = 0'.

If <weight> is non-zero, then tails that  introduce  new  generators  for
only weight <weight> are computed and added, and  in  this  case  and  if
`<weight> \< PqPClass(<i>)', it is assumed that the tails that  introduce
new generators for  each  weight  from  `PqPClass(<i>)'  down  to  weight
`<weight>  +  1'  have  already  been  added.  You  may  wish   to   call
`PqSetMetabelian' (see~"PqSetMetabelian") prior to calling `PqTails'.

*Notes*

For its use in the context of finding the next class  see  "PqNextClass";
in     particular,     a     call     to      `PqSetupTablesForNextClass'
(see~"PqSetupTablesForNextClass")  needs  to  have  been  made  prior  to
calling `PqTails'.

The single command: `PqTails(<i>, <weight>);' is equivalent to

\){\kernttindent}PqComputeTails(<i>, <weight>);
\){\kernttindent}PqAddTails(<i>, <weight>);

For those familiar with the `pq' binary, `PqTails' uses menu  item  7  of
the Advanced $p$-Quotient menu.

\>PqComputeTails( <i>, <weight> ) F
\>PqComputeTails( <weight> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to compute tails of weight <weight> if <weight> is in the  integer
range `[2 .. PqPClass(<i>)]' (assuming <i> is the number of the  process,
even in the default case) or for all  weights  if  `<weight>  =  0'.  See
`PqTails' ("PqTails") for more details.

*Note:*
For those familiar with the `pq' binary, `PqComputeTails' uses menu  item
7 of the Advanced $p$-Quotient menu.

\>PqAddTails( <i>, <weight> ) F
\>PqAddTails( <weight> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to add the  tails  of  weight  <weight>,  previously  computed  by
`PqComputeTails' (see~"PqComputeTails"), if <weight> is  in  the  integer
range `[2 .. PqPClass(<i>)]' (assuming <i> is the number of the  process,
even in the default case) or for all  weights  if  `<weight>  =  0'.  See
`PqTails' ("PqTails") for more details.

*Note:*
For those familiar with the `pq' binary, `PqAddTails' uses menu item 7 of
the Advanced $p$-Quotient menu.

\>PqDoConsistencyChecks( <i>, <weight>, <type> ) F
\>PqDoConsistencyChecks( <weight>, <type> ) F

for the <i>th or default interactive  {\ANUPQ}  process,  do  consistency
checks for weight <weight> if <weight> is in the  integer  range  `[3  ..
PqPClass(<i>)]' (assuming <i> is the number of the process)  or  for  all
weights if `<weight> = 0', and for type <type> if <type> is in the  range
`[1, 2, 3]' (see below) or for all types if `<type> = 0'. (For its use in
the context of finding the next class see "PqNextClass".)

The  *type*   of   a   consistency   check   is   defined   as   follows.
`PqDoConsistencyChecks(<i>, <weight>, <type>)' for  <weight>  in  `[3  ..
PqPClass(<i>)]' and the given  value  of  <type>  invokes  the  following
`PqJacobi' checks (see~"PqDoConsistencyCheck"):

\beginitems

`<type> = 1':&
`PqJacobi(<i>, <a>, <a>, <a>)' checks for  pc  generators  of  index  <a>
satisfying `2 * PqWeight(<i>, <a>) + 1 = <weight>'.

`<type> = 2':&
`PqJacobi(<i>, <b>, <b>, <a>)' checks for pc generators of  indices  <b>,
<a> satisfying `<b> > <a>' and `PqWeight(<i>, <b>) + PqWeight(<i>, <a>) +
1 = <weight>'.

`<type> = 3':&
`PqJacobi(<i>, <c>, <b>, <a>)' checks for pc generators of  indices  <c>,
<b>, <a> satisfying `<c> > <b> > <a>' and the sum of the weights of these
generators equals <weight>.

\enditems

*Notes*

`PqWeight(<i>, <j>)' returns the weight of the <j>th  pc  generator,  for
process <i> (see~"PqWeight").

It is assumed that tails for the given weight (or weights)  have  already
been added (see~"PqTails").

For those familiar with the `pq' binary, `PqDoConsistencyChecks' performs
menu item 8 of the Advanced $p$-Quotient menu.

\>PqCollectDefiningRelations( <i> ) F
\>PqCollectDefiningRelations() F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to collect the images of the defining relations of the original fp
group of the process, with respect to the current pc presentation, in the
context of finding the  next  class  (see~"PqNextClass").  If  the  tails
operation  is  not  complete  then  the  relations   may   be   evaluated
incorrectly.

*Note:*
For those familiar with  the  `pq'  binary,  `PqCollectDefiningRelations'
performs menu item 9 of the Advanced $p$-Quotient menu.

\>PqCollectWordInDefiningGenerators( <i>, <word> ) F
\>PqCollectWordInDefiningGenerators( <word> ) F

for the <i>th or default interactive {\ANUPQ} process, this can  be  used
in      the      same      way      as       `PqCollectDefiningRelations'
(see~"PqCollectDefiningRelations") to collect a user-defined word in  the
generators of the original fp group of the process, with respect  to  the
current pc presentation,  in  the  context  of  finding  the  next  class
(see~"PqNextClass").

*EXPLAIN FORM OF* <word>

*Note:*
For those familiar with the  `pq'  binary,  `PqCollectDefiningGenerators'
performs menu item 23 of the Advanced $p$-Quotient menu.

\>PqCommutatorDefiningGenerators( <i>, <words>, <pow> ) F
\>PqCommutatorDefiningGenerators( <words>, <pow> ) F

for the <i>th or default interactive {\ANUPQ} process, this can  be  used
in      the      same      way      as       `PqCollectDefiningRelations'
(see~"PqCollectDefiningRelations") to collect a  user-defined  commutator
in the generators of the original fp group of the process,  with  respect
to the current pc presentation, in the context of finding the next  class
(see~"PqNextClass").

*EXPLAIN FORM OF* <words>, <pow>

*Note:*
For those familiar with the `pq' binary, `PqCommutatorDefiningGenerators'
performs menu item 24 of the Advanced $p$-Quotient menu.

\>PqDoExponentChecks( <i> [: Bounds := <list> ]) F
\>PqDoExponentChecks([: Bounds := <list> ]) F

for the <i>th or default interactive {\ANUPQ} process, direct  the  `pq'
binary to do exponent checks for weights (inclusively) between the bounds
of `Bounds' or for all weights if `Bounds' is not given. The value <list>
of `Bounds' (assuming the interactive process is numbered <i>) should  be
a list of  two  integers  <low>,  <high>  satisfying  $1  \le  <low>  \le
<high> \le `PqPClass(<i>)'$ (see~"PqPClass").

*Note:*
For those familiar with the `pq'  binary,  `PqDoExponentChecks'  performs
menu item 10 of the Advanced $p$-Quotient menu.

\>PqEliminateRedundantGenerators( <i> ) F
\>PqEliminateRedundantGenerators() F

for the <i>th or default interactive {\ANUPQ} process, direct  the  `pq'
binary to eliminate redundant generators of the current $p$-quotient.

*Note:* 
For those familiar with the `pq' binary, `PqEliminateRedundantGenerators'
performs menu item 11 of the Advanced $p$-Quotient menu.

\>PqRevertToPreviousClass( <i> ) F
\>PqRevertToPreviousClass() F

for the <i>th or default interactive {\ANUPQ} process, direct  the  `pq'
binary to abandon the current class and revert to the previous class.

*Note:*
For  those  familiar  with  the  `pq'  binary,  `PqRevertToPreviousClass'
performs menu item 12 of the Advanced $p$-Quotient menu.

\>PqSetMaximalOccurrences( <i>, <noccur> ) F
\>PqSetMaximalOccurrences( <noccur> ) F

for the <i>th or default interactive {\ANUPQ} process, direct  the  `pq'
binary to set maximal occurrences of  the  weight  1  generators  in  the
definitions of pcp generators of the group of the process; <noccur>  must
be a list of non-negative integers of  length  the  number  of  weight  1
generators (i.e.~the rank of the class 1 $p$-quotient of the group of the
process). An entry of `0' for a particular generator indicates that there
is no limit on the number of occurrences for the generator.

*Note:*
For  those  familiar  with  the  `pq'  binary,  `PqSetMaximalOccurrences'
performs menu item 13 of the Advanced $p$-Quotient menu.

\>PqSetMetabelian( <i> ) F
\>PqSetMetabelian() F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to enforce metabelian-ness.

*Note:* 
For those familiar  with  the  `pq'  binary,  `PqSetMetabelian'  performs
menu item 14 of the Advanced $p$-Quotient menu.

\>PqDoConsistencyCheck( <i>, <c>, <b>, <a> ) F
\>PqDoConsistencyCheck( <c>, <b>, <a> ) F
\>PqJacobi( <i>, <c>, <b>, <a> ) F
\>PqJacobi( <c>, <b>, <a> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to do the Jacobi consistency check  for  the  pc  generators  with
indices <c>, <b>, <a> which should be non-increasing  positive  integers,
i.e.~$<c>   \ge   <b>   \ge   <a>$.   For   further   explanation,    see
`PqDoConsistencyChecks' ("PqDoConsistencyChecks").

*Note:*
For those familiar  with  the  `pq'  binary,  `PqDoConsistencyCheck'  and
`PqJacobi' perform menu item 15 of the Advanced $p$-Quotient menu.

\>PqCompact( <i> ) F
\>PqCompact() F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to do a compaction.

*Note:*
For those familiar with the `pq' binary, `PqCompact' performs  menu  item
16 of the Advanced $p$-Quotient menu.

\>PqEchelonise( <i> ) F
\>PqEchelonise() F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to echelonise the word most recently collected by  `PqCollect'  or
`PqCommutator' against the relations of the current  pc  presentation.  A
call    to    `PqCollect'     (see~"PqCollect")     or     `PqCommutator'
(see~"PqCommutator") needs to be performed prior to using this command.

*Note:*
For those familiar with the `pq'  binary,  `PqEchelonise'  performs  menu
item 17 of the Advanced $p$-Quotient menu.

\>PqSupplyAutomorphisms( <i>, <mlist> ) F
\>PqSupplyAutomorphisms( <mlist> ) F

for the  <i>th  or  default  interactive  {\ANUPQ}  process,  supply  the
automorphism  data  provided  by  the  list  <mlist>  of  matrices   with
non-negative integer coefficients. Each matrix in <mlist> must  have  the
same dimensions; in particular, the number of rows of each matrix must be
the number of pc generators of the  current  $p$-quotient  of  the  group
associated with the interactive {\ANUPQ} process.

*Note:* 
For those familiar with the  `pq'  binary,  `PqSupplyAutomorphisms'  uses
menu item 18 of the Advanced $p$-Quotient menu.

\>PqExtendAutomorphisms( <i> ) F
\>PqExtendAutomorphisms() F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to extend previously-supplied automorphisms.

*Note:*
For those familiar with the  `pq'  binary,  `PqExtendAutomorphisms'  uses
menu item 18 of the Advanced $p$-Quotient menu.

\>PqApplyAutomorphisms( <i>, <qfac> ) F
\>PqApplyAutomorphisms( <qfac> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to apply automorphisms; <qfac> is the queue factor e.g. `15'.

*Note:* 
For those familiar with  the  `pq'  binary,  `PqCloseRelations'  performs
menu item 19 of the Advanced $p$-Quotient menu.

\>PqDisplayStructure( <i> [: Bounds := <list> ]) F
\>PqDisplayStructure([: Bounds := <list> ]) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary  to  display  the  structure  for  the  pcp  generators   numbered
(inclusively) between the bounds of `Bounds' or  for  all  generators  if
`Bounds' is not  given.  The  value  <list>  of  `Bounds'  (assuming  the
interactive process is numbered <i>) should be a  list  of  two  integers
<low>,   <high>   satisfying   $1    \le    <low>    \le    <high>    \le
`PqNrPcGenerators(<i>)'$  (see~"PqNrPcGenerators").  `PqDisplayStructure'
also accepts the option `OutputLevel' (see "option OutputLevel").

*FURTHER EXPLANATION NEEDED*

*Note:*
For those familiar with the `pq'  binary,  `PqDisplayStructure'  performs
menu item 20 of the Advanced $p$-Quotient menu.

\>PqDisplayAutomorphisms( <i> [: Bounds := <list> ]) F
\>PqDisplayAutomorphisms([: Bounds := <list> ]) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to display the automorphism actions on the pcp generators numbered
(inclusively) between the bounds of `Bounds' or  for  all  generators  if
`Bounds' is not  given.  The  value  <list>  of  `Bounds'  (assuming  the
interactive process is numbered <i>) should be a  list  of  two  integers
<low>,   <high>   satisfying   $1    \le    <low>    \le    <high>    \le
`PqNrPcGenerators(<i>)'$  (see~"PqNrPcGenerators").  `PqDisplayStructure'
also accepts the option `OutputLevel' (see "option OutputLevel").

*Note:*
For  those  familiar  with  the  `pq'  binary,   `PqDisplayAutomorphisms'
performs menu item 21 of the Advanced $p$-Quotient menu.

\>PqWritePcPresentation( <i>, <filename> ) F
\>PqWritePcPresentation( <filename> ) F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to write a pc presentation of a  previously-computed  quotient  of
the group of that process, to the file with  name  <filename>.  Here  the
group of a process is the one given as first argument when `PqStart'  was
called to initiate that process (for process <i> the group is  stored  as
`ANUPQData.io[<i>].group').  If  the  first  character  of   the   string
<filename> is not `/', <filename> is assumed to be the path of a writable
file relative to the directory in which  {\GAP}  was  started.  If  a  pc
presentation has not been previously computed by the  `pq'  binary,  then
`pq'   is   called   to   compute   it   first,   effectively    invoking
`PqPcPresentation' (see~"PqPcPresentation").

*Note:* For those familiar with the `pq' binary,  `PqPcWritePresentation'
performs menu item 25 of the Advanced $p$-Quotient menu.

\>PqWriteCompactDescription( <i> ) F
\>PqWriteCompactDescription() F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to write a compact description 

*OF ....*

to a file.

*Note:* 
For those familiar  with  the  `pq'  binary,  `PqWriteCompactDescription'
performs menu item 26 of the Advanced $p$-Quotient menu.

*Commands from the Standard Presentation menu*

\>PqSPComputePcpAndPCover( <i> : <options> ) F
\>PqSPComputePcpAndPCover( : <options> ) F

for the <i>th or default interactive {\ANUPQ} process, directs  the  `pq'
binary to compute for the group of that process a pc presentation  up  to
the $p$-quotient of maximum class or the value of the option `ClassBound'
and the $p$-cover of that  quotient,  and  sets  up  tabular  information
required for computation of a standard presentation. Here the group of  a
process is the one given as first argument when `PqStart' was  called  to
initiate  that  process  (for  process  <i>  the  group  is   stored   as
`ANUPQData.io[<i>].group').

The possible <options> are `Prime', `ClassBound', `Relators', `Exponent',
`Metabelian' and `OutputLevel' (see Chapter~"ANUPQ Options" for  detailed
descriptions of these options). The option `Prime' is normally determined
via `PrimePGroup', and so is not required unless the group  doesn't  know
it's a $p$-group and `HasPrimePGroup' returns `false'.

*Note:*
For  those  familiar  with  the  `pq'  binary,  `PqSPComputePcpAndPCover'
performs option 1 of the Standard Presentation menu.

\>PqSPStandardPresentation( <i>[, <mlist>][: <options>]) F
\>PqSPStandardPresentation( [<mlist>][: <options>]) F

for the <i>th or default interactive {\ANUPQ} process, inputs data  given
by <options> to compute a standard presentation for  the  group  of  that
process.  If  argument  <mlist>  is  given  it  is  assumed  to  be   the
automorphism group data required. Otherwise it is assumed that a call  to
either      `Pq'      (see~"Pq!interactive")      or      `PqEpimorphism'
(see~"PqEpimorphism!interactive") has generated a $p$-quotient  and  that
{\GAP} can compute  its  automorphism  group  from  which  the  necessary
automorphism group data can be derived. The group of the process  is  the
one given as first argument when `PqStart' was  called  to  initiate  the
process (for process <i> the group is stored as `ANUPQData.io[<i>].group'
and     the     $p$-quotient     if     existent     is     stored     as
`ANUPQData.io[<i>].pQuotient').  If  <mlist>   is   not   given   and   a
$p$-quotient of the group has not been  previously  computed  a  class  1
$p$-quotient is computed.

`PqSPStandardPresentation' accepts three options, all optional:

\beginlist%unordered

\atindex{option ClassBound}{@option \noexpand`ClassBound'}
\item{}`ClassBound := <n>'

\atindex{option PcgsAutomorphisms}{@option \noexpand`PcgsAutomorphisms'}
\item{}`PcgsAutomorphisms'

\atindex{option StandardPresentationFile}%
{@option \noexpand`StandardPresentationFile'}
\item{}`StandardPresentationFile := <filename>'

\endlist

If `ClassBound' is omitted it defaults to 63.

Detailed descriptions of the above options may be found in Chapter~"ANUPQ
options".

*Note:* For those familiar with  the  `pq'  binary,  `PqSPPcPresentation'
performs menu item 2 of the Standard Presentation menu.

\>PqSPSavePresentation( <i>, <filename> ) F
\>PqSPSavePresentation( <filename> ) F

for the <i>th or default interactive {\ANUPQ} process, directs  the  `pq'
binary to save the standard  presentation  previously  computed  for  the
group of that process to the file with name <filename>, where  the  group
of a process is the one given as first argument when `PqStart' was called
to initiate that process. If the first character of the string <filename>
is not `/', <filename> is assumed to be  the  path  of  a  writable  file
relative to the directory in which {\GAP} was started.

*Note:* For those familiar with the `pq'  binary,  `PqSPSavePresentation'
performs menu item 3 of the Standard Presentation menu.

\>PqSPCompareTwoFilePresentations( <i>, <f1>, <f2> ) F
\>PqSPCompareTwoFilePresentations( <f1>, <f2> ) F

for the <i>th or default interactive {\ANUPQ} process, direct  the  `pq'
binary to compare the presentations in the files with names <f1> and <f2>
and returns `true' if they are identical and `false' otherwise. For  each
of the strings <f1> and <f2>, if the first character is not a `/' then it
is assumed to be the path of a readable file relative to the directory in
which {\GAP} was started.

*Notes*

The presentations in files <f1> and <f2> must have been generated by  the
`pq' binary but they do *not* need to be *standard* presentations.

For      those      familiar      with       the       `pq'       binary,
`PqSPCompareTwoFilePresentations' performs menu item 6  of  the  Standard
Presentation menu.

\>PqSPIsomorphism( <i> ) F
\>PqSPIsomorphism() F

for the <i>th or default interactive {\ANUPQ} process,  direct  the  `pq'
binary to compute the isomorphism mapping from the pc  $p$-group  of  the
process to its standard presentation.

*CHECK THAT THIS DOES SOMETHING USEFUL*

The ``given'' group is `ANUPQData.io[<i>].pQuotient'.

*Note:* For  those  familiar  with  the  `pq'  binary,  `PqSPIsomorphism'
performs menu item 8 of the Standard Presentation menu.

*Commands from the Main $p$-Group Generation menu*

Note that the $p$-group generation commands can only be applied once  the
`pq' binary has produced a pc presentation of some quotient group of  the
``group of the process''.

\>PqPGSupplyAutomorphisms( <i>[, <mlist>] ) F
\>PqPGSupplyAutomorphisms([<mlist>]) F

for the <i>th or default interactive {\ANUPQ} process,  supply  the  `pq'
binary with the automorphism group data needed for the  current  quotient
of the group of that process (for process <i>  the  group  is  stored  as
`ANUPQData.io[<i>].group'). If <mlist> is omitted the  automorphism  data
is determined from the group of  the  process  which  must  have  been  a
$p$-group in pc presentation. Otherwise the automorphism data is provided
from <mlist> which should be a list of matrices with non-negative integer
coefficients, where  each  matrix  must  have  the  same  dimensions;  in
particular, the number of rows of each matrix must be  the  rank  of  the
group of the process.

*Note:*
For  those  familiar  with  the  `pq'  binary,  `PqPGSupplyAutomorphisms'
performs menu item 1 of the main $p$-Group Generation menu.

\>PqPGExtendAutomorphisms( <i> ) F
\>PqPGExtendAutomorphisms() F

for the <i>th or default interactive {\ANUPQ} process, directs  the  `pq'
binary to compute the extensions of the automorphisms defined by  calling
`PqPGSupplyAutomorphisms' (see~"PqPGSupplyAutomorphisms"). You  may  wish
to set the `InfoLevel' of `InfoANUPQ' to 2 (or more) in order to see  the
output from the `pq' (see~"InfoANUPQ").

*Note:*    
For  those  familiar  with  the  `pq'  binary,  `PqPGExtendAutomorphisms'
performs menu item 2 of the main or advanced $p$-Group Generation menu. 

\>PqPGRestoreGroupFromFile( <i>, <cls>, <n> ) F
\>PqPGRestoreGroupFromFile( <cls>, <n> ) F

for the <i>th  or  default  interactive  {\ANUPQ}  process  and  positive
integers <cls> and <n>, direct the `pq' binary to restore  group  <n>  of
class <cls> from a temporary file.

*Note:* 
For those  familiar  with  the  `pq'  binary,  `PqPGRestoreGroupFromFile'
performs menu item 3 of the main or advanced $p$-Group Generation menu.

\>PqPGConstructDescendants( <i> : <options> ) F
\>PqPGConstructDescendants( : <options> ) F

for the <i>th or default interactive {\ANUPQ} process, inputs data  given
by <options> to the `pq' binary to  construct  descendants.  The  options
possible are the same as those listed for the interactive `PqDescendants'
(see~"PqDescendants!interactive")   function,    namely:    `ClassBound',
`Relators',      `OrderBound',      `StepSize',      `PcgsAutomorphisms',
`RankInitialSegmentSubgroups',  `SpaceEfficient',   `CapableDescendants',
`AllDescendants',  `Exponent',  `Metabelian',   `GroupName',   `SubList',
`BasicAlgorithm',  `CustomiseOutput'.  (Detailed  descriptions  of  these
options may be found in Chapter~"ANUPQ options".)

`PqPGConstructDescendants' requires that the `pq' binary  has  previously
computed a pc presentation and a $p$-cover for  a  $p$-quotient  of  some
class of the group of the process.

*Note:* 
For those  familiar  with  the  `pq'  binary,  `PqPGConstructDescendants'
performs menu item 5 of the main $p$-Group Generation menu.

*Commands from the Advanced $p$-Group Generation menu*

\>PqAPGSupplyAutomorphisms( <i>[, <mlist>] ) F
\>PqAPGSupplyAutomorphisms([<mlist>]) F

for the <i>th or default interactive {\ANUPQ} process,  supply  the  `pq'
binary with the automorphism group data needed  for  the  group  of  that
process    (for    process    <i>    the    group    is     stored     as
`ANUPQData.io[<i>].group'). If  the  argument  <mlist>  is  omitted  then
{\GAP} *must* be able to determine the automorphism group of the group of
the process. Otherwise the automorphism data  is  provided  from  <mlist>
which  should  be  a  list  of   matrices   with   non-negative   integer
coefficients, where  each  matrix  must  have  the  same  dimensions;  in
particular, the number of rows of each matrix must be  the  rank  of  the
group of the process.

*Note:*
For those  familiar  with  the  `pq'  binary,  `PqAPGSupplyAutomorphisms'
performs menu item 1 of the Advanced $p$-Group Generation menu.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Primitive Interactive ANUPQ Process Read/Write Functions}

For those familiar with using the `pq' binary as a standalone we  provide
primitive read/write tools to communicate directly  with  an  interactive
{\ANUPQ} process, started via `PqStart'. For the most part, it is  up  to
the user to translate the output strings from `pq'  binary  into  a  form
useful in {\GAP}.

\>PqRead( <i> ) F
\>PqRead() F

read a complete line of  {\ANUPQ}  output,  from  the  <i>th  or  default
interactive {\ANUPQ} process, if there is output to be read  and  returns
`fail' otherwise. When successful, the  line  is  returned  as  a  string
complete with trailing newline, colon, or question-mark character. Please
note that it is possible to be ``too  quick''  (i.e.~the  return  can  be
`fail' purely because the output from {\ANUPQ} is not there yet), but  if
`PqRead' finds any output at all, it waits for a complete line.  `PqRead'
also writes the line read via `Info' at `InfoANUPQ' level 2.  It  doesn't
try to distinguish banner and menu output from other output of  the  `pq'
binary.

\>PqReadAll( <i> ) F
\>PqReadAll() F

read and return as many *complete* lines of  {\ANUPQ}  output,  from  the
<i>th or default interactive {\ANUPQ} process, as there are to  be  read,
*at the time of the call*,  as  a  list  of  strings  with  any  trailing
newlines removed and returns the empty list otherwise.  `PqReadAll'  also
writes each line read via `Info' at `InfoANUPQ' level 2. It  doesn't  try
to distinguish banner and menu output  from  other  output  of  the  `pq'
binary. Whenever `PqReadAll' finds only a partial line, it waits for  the
complete line, thus increasing the probability that it has  captured  all
the output to be had from {\ANUPQ}.

\>PqReadUntil( <i>, <IsMyLine> ) F
\>PqReadUntil( <IsMyLine> ) F
\>PqReadUntil( <i>, <IsMyLine>, <Modify> ) F
\>PqReadUntil( <IsMyLine>, <Modify> ) F

read complete lines  of  {\ANUPQ}  output,  from  the  <i>th  or  default
interactive {\ANUPQ} process, ``chomps'' them (i.e.~removes any  trailing
newline character), emits them to `Info' at `InfoANUPQ' level 2  (without
trying to distinguish banner and menu output from  other  output  of  the
`pq' binary), and applies the function <Modify> (where <Modify>  is  just
the identity map/function for the first two forms)  until  a  ``chomped''
line  <line>  for  which  `<IsMyLine>(  <Modify>(<line>)  )'   is   true.
`PqReadUntil' returns the list of <Modify>-ed ``chomped'' lines read.

*Notes:* 
When provided by the user, <Modify> should be a function that  accepts  a
single string argument.

<IsMyLine> should be a function that is able  to  accept  the  output  of
<Modify> (or take a single string argument when <Modify> is not provided)
and should return a boolean.

If `<IsMyLine>( <Modify>(<line>) )' is  never  true,  `PqReadUntil'  will
wait indefinitely.

\>PqWrite( <i>, <string> ) F
\>PqWrite( <string> ) F

write <string> to the <i>th  or  default  interactive  {\ANUPQ}  process;
<string> must be in exactly the form the {\ANUPQ} standalone expects. The
command is echoed via `Info' at `InfoANUPQ' level 3 (with a  ```ToPQ> '''
prompt); i.e.~do `SetInfoLevel(InfoANUPQ, 3);' to see what is transmitted
to the `pq' binary. `PqWrite' returns `true' if successful in writing  to
the stream of the interactive {\ANUPQ} process, and `fail' otherwise.

*Note:*
If `PqWrite' returns `fail' it means that the {\ANUPQ} process has died.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%E
