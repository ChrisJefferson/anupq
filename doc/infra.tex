%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%W  infra.tex       ANUPQ documentation - infrastructure    Werner Nickel
%W                                                            Greg Gamble
%%
%H  $Id$
%%
%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Chapter{Infrastructure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Loading the ANUPQ Share Package}

To use the {\ANUPQ} Share Package you have to request it explicitly. This
is done by calling

\beginexample
gap> RequirePackage("anupq");
#I    Loading the ANUPQ (ANU p-Quotient) share package
#I    C code by  Eamonn O'Brien <obrien@math.auckland.ac.nz>
#I                ANU pq binary version: 1.4
#I    GAP code by Werner Nickel <nickel@mathematik.tu-darmstadt.de>
#I            and   Greg Gamble  <gregg@math.rwth-aachen.de>
#I                ANUPQ package version: 1.0
#I  
#I                For help, type: ?ANUPQ
true
\endexample

The `RequirePackage' command is described in Section~"ref:RequirePackage"
in the {\GAP} Reference Manual.

If {\GAP} cannot find a working binary, the call to `RequirePackage' will
fail.

If you know you have a working {\ANUPQ} binary, as well  as  a  correctly
installed {\ANUPQ} Share Package, it is possible to suppress  the  `Info'
messages by temporarily setting the `InfoLevel' of  `InfoWarning'  to  0,
and a duplicated semicolon will suppress the `true' result:

\beginexample
gap> SetInfoLevel(InfoWarning, 0); RequirePackage( "ace" );;
gap> SetInfoLevel(InfoWarning, 1);
\endexample

If you want to load the {\ANUPQ} package by  default,  you  can  put  the
`RequirePackage' command into your `.gaprc'  file  (see  Section~"ref:The
.gaprc file" in the {\GAP} Reference Manual).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{The ANUPQData Record}

\>`ANUPQData' V

is a {\GAP} record in which the essential data for  an  {\ANUPQ}  session
within {\GAP} is stored; its fields are:

\beginitems

\quad`binary' & the path of the {\ANUPQ} binary;

\quad`tmpdir' & the path of the temporary  directory  used  by  the  `pq'
binary and {\GAP} (i.e.~the directory in which all the  `pq''s  temporary
files are created) (also see "ANUPQDirectoryTemporary" below);

\quad`outfile'& the full path of the default `pq' output  file;

\quad`SPimages'& the full path of the file  `GAP_library'  to  which  the
`pq' binary writes its Standard Presentation images;

\quad`version'& the version of the current `pq' binary;

\quad`ni' & a data record used by non-interactive  functions  (see  below
and Chapter~"Non-interactive ANUPQ Functions"); and

\quad`io' & list of data records for `PqStart' (see below  and~"PqStart")
processes;

\enditems

Each time an interactive {\ANUPQ}  process  is  initiated  via  `PqStart'
(see~"PqStart"), an identifying number <ioIndex>  is  generated  for  the
interactive process and a record `ANUPQData.io[<ioIndex>]' with  some  or
all of the fields listed below is  created.  Whenever  a  non-interactive
function is called (see Chapter~"Non-interactive ANUPQ  Functions"),  the
record `ANUPQData.ni' is updated with fields that, if bound, have exactly
the same purpose as listed below.

\beginitems

\quad`stream'& the  IOStream  opened  for  interactive  {\ANUPQ}  process
<ioIndex> or non-interactive {\ANUPQ} function;

\quad`group'& the group given as first argument to `PqStart';

\quad`workspace'& the workspace set for the `pq' process (either given as
a second argument to `PqStart', or set by default to 10000000);

\quad`menu'& the current menu of the `pq' process  (the  `pq'  binary  is
managed by various  menus,  the  details  of  which  the  user  shouldn't
normally need to know about -- the `menu' field remembers which menu  the
`pq' process is currently ``in'');

\quad`outfname' & is the file to which `pq' output is directed, which  is
always `ANUPQData.outfile', except when option `SetupFile' is used with a
non-interactive  function,  in  which   case   `outfname'   is   set   to
`"PQ_OUTPUT"';

\quad`pQpcp' & If this field is bound  it  is  a  record  containing  the
options used the last time that  `pq'  computed  a  pc  presentation  for
`group', while computing a $p$-quotient i.e.~if it is  bound  then  there
has been such a call. (It is used  mainly  to  avoid  re-computing  a  pc
presentation that's been done already, by functions that require  that  a
pc presentation is known to the `pq' binary.)

\quad`pQuotient'  &  This  is  set  to  the  value   returned   by   `Pq'
(see~"Pq!interactive") when called interactively, for process  <i>.  (The
field `pQepi' is also set at the same time.)

\quad`pQepi' & This is set  to  the  value  returned  by  `PqEpimorphism'
(see~"PqEpimorphism!interactive") when called interactively, for  process
<i>. (The field `pQuotient' is also set at the same time.)

\quad`SPpcp' & If this field is bound  it  is  a  record  containing  the
options used the last time that  `pq'  computed  a  pc  presentation  for
`group', while computing a standard presentation i.e.~if it is bound then
there has been such a call. (It is used mainly to avoid re-computing a pc
presentation that's been done already, by functions that require  that  a
pc presentation is known to the `pq' binary.)

\quad`SP' & This is set to the value returned by `PqStandardPresentation'
or `StandardPresentation' (see~"PqStandardPresentation!interactive") when
called interactively, for process <i>. (The field `SPepi' is also set  at
the same time.)

\quad`SPepi'   &   This   is   set   to    the    value    returned    by
`EpimorphismPqStandardPresentation' or  `EpimorphismStandardPresentation'
(see~"EpimorphismPqStandardPresentation!interactive")     when     called
interactively, for process <i>. (The field `SP' is also set at  the  same
time.)

\enditems

\>ANUPQDirectoryTemporary( <dir> ) F

calls the UNIX command `mkdir' to create <dir>, which must be  a  string,
and if successful a directory  object  for  <dir>  is  both  assigned  to
`ANUPQData.tmpdir'  and  returned.  The  fields  `ANUPQData.infile'   and
`ANUPQData.outfile' are also set to be files in  `ANUPQData.tmpdir',  and
on exit from {\GAP} <dir> is removed. Most users  will  never  need  this
command; by default, {\GAP} typically chooses a  ``random''  subdirectory
of `/tmp' for `ANUPQData.tmpdir' which may occasionally  have  limits  on
what may be written there. `ANUPQDirectoryTemporary' permits the user  to
choose a directory (object) where one is not so limited.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\Section{Setting the Verbosity of ANUPQ via Info and InfoANUPQ}

\>`InfoANUPQ' V

The input to and the output from the `pq'  binary  is,  by  default,  not
displayed. However the user may choose to  see  some,  or  all,  of  this
input/output.   This   is   done   via   the   `Info'   mechanism    (see
Chapter~"ref:Info Functions" in the {\GAP} Reference  Manual).  For  this
purpose,  there  is  the  <InfoClass>  `InfoANUPQ'.  Each  line  of  `pq'
input/output is directed to a call to `Info' and will  be  displayed  for
the user to see if the `InfoLevel' of  `InfoANUPQ'  is  high  enough.  By
default, the `InfoLevel' of `InfoANUPQ' is 1, and it is recommended  that
you leave it at this level, or higher. Only messages which we think  that
the user will really want to see are directed to  `Info'  at  `InfoANUPQ'
level 1. To turn off *all* `InfoANUPQ'  messaging,  set  the  `InfoANUPQ'
level to 0.

Currently, information from the `pq' binary is directed to `Info' at five
`InfoANUPQ' levels: 1, 2, 3, 4 and 5. The command

\beginexample
gap> SetInfoLevel(InfoANUPQ, 2);
\endexample

enables the display of results from the `pq'  binary.

\beginexample
gap> SetInfoLevel(InfoANUPQ, 3);
\endexample

enables the display of all the input sent to the `pq'  binary,  behind  a
```ToPQ> ''' prompt (so that you can distinguish it from the output  from
the `pq' binary). Finally,

\beginexample
gap> SetInfoLevel(InfoANUPQ, 4);
\endexample

enables the display of all other output from the `pq' binary, namely  the
banner, menus, and the timing data printed when the  `pq'  binary  exits.
The fifth `InfoANUPQ' level is intended only for debugging purposes,  and
gives all partial results of commands that read from an iostream.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%E
